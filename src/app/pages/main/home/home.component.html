<div class="home-container">
  <h2>Welcome {{ currentUserFirstName }}</h2>
  <div class="search-container">
    <form (ngSubmit)="onSearch()">
      <input type="text" placeholder="Search users..." [(ngModel)]="searchQuery" name="query" (input)="onTextAreaInput($event)"/>
      <button type="submit">Search</button>
    </form>
  </div>



  <div class="form-container">
    <h4>Share things with your friends</h4>
    <form [formGroup]="postForm" (ngSubmit)="onSubmit()">
      <div class="file-upload-container">
        <input id="file-upload" type="file" formControlName="image" (change)="onFileChange($event)" />
      </div>
      
      <textarea formControlName="description" placeholder="Write something... {{currentUserFirstName}}" (input)="onTextAreaInput($event)"></textarea>
      <label for="file-upload" class="custom-file-upload">
        <img src="../../../../assets/icons/addimage.svg" alt="Upload Icon" class="upload-icon">
      </label>
      <div class="button-container">
        <button type="submit">Upload</button>
      </div>
      </form>
  </div>
  
  


  <div class="content-section">
    <div class="post" *ngFor="let post of posts">
      <div *ngIf="post.description.startsWith('Shared Post:'); else regularOrSystemPost">
        <div class="shared-info" *ngIf="post.sharedText && post.sharedBy">
          <p><strong>Shared by {{ post.sharedBy.firstName }} {{ post.sharedBy.lastName }}:</strong> {{ post.sharedText }}</p>
          <span class="shared-date">{{ post.sharedAt | date:'short' }}</span>
        </div>
        <div class="shared-post">
          <div class="post-header">
            <a [routerLink]="['/another', post.author.username]" class="user-link">
              <img [src]="'../../../../assets/icons/userprofile.svg'" alt="Profile Image" class="profile-image lower-image" width="35" height="35">
              <strong>{{ post.author.firstName }} {{ post.author.lastName }} ({{ post.author.username }})</strong>
            </a>
            <span class="post-date">{{ post.createdAt | date:'short' }}</span>
          </div>
          <p class="post-description" [ngStyle]="{'direction': getTextDirection(post.description)}">
            {{ post.description }}
          </p>
          <img class="post-image" [src]="sanitizeImageUrl(post.image)" alt="Post image" *ngIf="post.image">
        </div>
        <div class="info-group">
          <!-- כפתורים עבור פוסטים משותפים -->
          <button class="info-button" (click)="likePost(post)">
            {{ post.liked ? 'Unlike' : 'Like' }} ({{ post.likes.length }})
          </button>
          <button class="info-button delete-button" *ngIf="post.author.username === currentUser" (click)="confirmUnshare(post)">Unshare</button>
        </div>
      </div>
      <ng-template #regularOrSystemPost>
        <div class="post-header">
          <ng-container *ngIf="!post.systemPost; else systemPost">
            <a [routerLink]="[post.author.username === currentUser ? '/profile' : '/another', post.author.username]" class="user-link">
              <img [src]="'../../../../assets/icons/userprofile.svg'" alt="Profile Image" class="profile-image lower-image" width="35" height="35">
              <strong>{{ post.author.firstName }} {{ post.author.lastName }} ({{ post.author.username }})</strong>
            </a>
          </ng-container>
          <ng-template #systemPost>
            <div class="user-link">
              <img [src]="'../../../../assets/icons/system.svg'" alt="Profile Image" class="profile-image lower-image" width="35" height="35">
              <strong>{{ post.author.firstName }} {{ post.author.lastName }}</strong>
            </div>
          </ng-template>
          <span class="post-date">{{ post.createdAt | date:'short' }}</span>
        </div>
        <p class="post-description" [ngStyle]="{'direction': getTextDirection(post.description)}">
          {{ post.description }}
        </p>
        <img class="post-image" [src]="sanitizeImageUrl(post.image)" alt="Post image" *ngIf="post.image">
        <div *ngIf="!post.systemPost" class="info-group">
          <!-- כפתורים עבור פוסטים רגילים -->
          <button class="info-button" (click)="likePost(post)">
            {{ post.liked ? 'Unlike' : 'Like' }} ({{ post.likes.length }})
          </button>
          <button class="info-button" (click)="sharePost(post)">
            Share ({{ post.shares.length }})
          </button>
          <button class="info-button" (click)="savePost(post)">
            {{ post.saved ? 'Unsave' : 'Save' }}
          </button>
          <button class="info-button edit-button" *ngIf="post.author.username === currentUser" (click)="editPost(post)">Edit</button>
          <button class="info-button delete-button" *ngIf="post.author.username === currentUser" (click)="confirmDelete(post)">Delete</button>
        </div>
      </ng-template>
    </div>
  </div>
    
  <!-- Edit post modal -->
  <div *ngIf="editingPost" class="edit-dialog">
    <form (ngSubmit)="saveEdit()">
      <textarea [(ngModel)]="editingPost.description" name="description" placeholder="Edit description"></textarea>
      <input type="file" (change)="onFileChange($event)" />
      <img *ngIf="editingPost.image" [src]="editingPost.image" alt="Selected image" class="edit-image-preview" />
      <button class="info-button save-button" type="submit">Save</button>
      <button class="info-button cancel-button" (click)="cancelEdit()">Cancel</button>
      <button type="button" class="info-button remove-image-button" (click)="removeImage()">Remove Image</button>
    </form>
  </div>

  <!-- Success dialog -->
  <div *ngIf="editSuccess" class="success-dialog">
    <p>Your post was edited successfully</p>
    <button class="info-button ok-button" (click)="closeSuccessDialog()">OK</button>
  </div>

  <div *ngIf="postToDelete" class="delete-dialog">
    <p>Are you sure you want to delete this post ?</p>
    <div class="delete-dialog-buttons">
      <button class="info-button cancel-button" (click)="cancelDelete()">Cancel</button>
      <button class="info-button confirm-button" (click)="deletePost(postToDelete)">Confirm</button>
    </div>
  </div>
</div>

